% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/CosMx_NoButter.R
\name{PrepareGEXMatrix}
\alias{PrepareGEXMatrix}
\title{Prepare Gene Expression (GEX) Matrix with Full Cell Identifiers and Optional Prefix}
\usage{
PrepareGEXMatrix(
  raw_transcripts,
  z_stacks,
  output_dir = NULL,
  save_matrix = FALSE,
  file_prefix = "",
  slide_id = 1
)
}
\arguments{
\item{raw_transcripts}{A data frame or a character string path to a CSV file containing
raw transcript data. Must include either a `cell` column in the format
`c_<Slide>_<FOV>_<CellId>` or the separate columns `Slide`, `fov`, and `CellId`.}

\item{z_stacks}{An integer vector of Zâ€‘slice indices to retain in the analysis.}

\item{output_dir}{Optional character string specifying a directory to save the
cleaned expression matrix when `save_matrix = TRUE`.}

\item{save_matrix}{Logical; if `TRUE`, the resulting count matrix is written as
`exprMat_zclean.csv` under `output_dir` (and `file_prefix` if provided). Defaults to `FALSE`.}

\item{file_prefix}{Optional character string to prefix the output file path. Can be used as a
sub-directory name or filename prefix. Defaults to an empty string (no prefix).}

\item{slide_id}{Single integer.  Which slide are we on?  Defaults to 1.}
}
\value{
A data frame (matrix) of counts where row names are full cell IDs and column
  names are transcript targets.
}
\description{
This function constructs a cleaned GEX count matrix from raw CosMx SMI transcript data,
ensuring that full cell IDs (c_<Slide>_<FOV>_<CellId>) are preserved. If the raw data
already contains a valid `cell` column, it will be used directly; otherwise the function
will reconstruct full cell IDs from `Slide`, `fov`, and `CellId` columns. You can also
provide a `file_prefix` to save the matrix under a sub-directory or filename prefix.
}
\examples{
\dontrun{
# Using an in-memory data frame and save without prefix
raw_df <- read.csv("raw_transcripts.csv", stringsAsFactors = FALSE)
gex_mat <- PrepareGEXMatrix(raw_df, z_stacks = 1:5, save_matrix = TRUE, output_dir = "results/")

# Using a file prefix for saving under a sub-directory
gex_mat <- PrepareGEXMatrix(
  raw_transcripts = "raw_transcripts.csv",
  z_stacks       = c(1,2,3),
  output_dir     = "results/",
  save_matrix    = TRUE,
  file_prefix    = "exp1"
)
}
}
